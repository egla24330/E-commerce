import{r as a,S as P,A as X,j as e,a as f,y as s}from"./index-HS-0_6p7.js";import{R as _}from"./ReceiptSuccessModal-Cf_yqeK_.js";import{H as B}from"./Helmet-BQrkXuiA.js";import{U as I}from"./user-DRTE7aoD.js";import{M as U}from"./mail-CXaNHpyZ.js";import{c as w}from"./createLucideIcon-BekIGk2A.js";import{C as D}from"./ClipLoader-BU5QXpBz.js";import"./index-BTT9Qpdf.js";import"./index-hTSXAHiY.js";import"./proxy-4A12_6Dc.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],R=w("gift",H);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],T=w("id-card",F);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],J=w("share-2",z),ne=()=>{const{backendurl:m}=a.useContext(P),{token:y}=a.useContext(X),[x,k]=a.useState(!1),[r,h]=a.useState(0),[n,C]=a.useState(""),[d,S]=a.useState(""),[A,j]=a.useState(!1),[g,E]=a.useState(""),[p,N]=a.useState(!1),[l,q]=a.useState({}),[i,W]=a.useState(0),[o,Y]=a.useState(""),[M,v]=a.useState(!1);a.useEffect(()=>{r<999?N(!0):N(!1)},[h,r]);const u=async()=>{try{const t=await f.post(`${m}/api/user/me`,{},{headers:{token:y}});console.log("User data fetched:",t),t.data.success===!0?(q(t.data.userData),E(t.data.userData._id),W(t.data.userData.coins)):s.error("Failed to fetch user data")}catch{return s.error("Error fetching user data"),null}};a.useEffect(()=>{u()},[]);const b=`${window.location.origin}/register?ref=${l==null?void 0:l.referralCode}`,$=async()=>{try{navigator.share?await navigator.share({title:"Join YegnaCart",text:"Join YegnaCart and earn 5 YegnaCoins!",url:b}):(await navigator.clipboard.writeText(b),s.success("Invite link copied to clipboard!"))}catch(t){s.error("Failed to share invite link."),console.error(t)}};if(!l)return e.jsx("div",{className:"p-6 text-center",children:"Loading profile..."});let L=async()=>{let t=s.loading("Processing withdrawal request...");if(!o.trim()||!/^09\d{8}$/.test(o)){s.error("Enter a valid Ethiopian phone number (e.g., 09XXXXXXXX)");return}if(!n.trim()||n.length<6){s.error("Enter a valid Bank Account Number");return}if(p)s.error("Minimum withdrawal amount is 999 coin.");else if(r>i)s.error("You cannot withdraw more than your current balance.");else{j(!0);try{let c=i-r;if(console.log({leftDeposite:c,banckAccount:n,Name:d,id:g,Phone:o,withdrawalAmount:r}),(await f.post(`${m}/api/withdrawal/withdrawal-update`,{coin:c},{headers:{token:y}})).data.success){const V=await f.post(`${m}/api/withdrawal/withdrawal-request`,{withdrawalAmount:r,bankAccount:n,name:d,userId:g,phone:o,leftDeposite:c});u(),s.update(t,{render:"Withdrawal request submitted successfully!",type:"success",isLoading:!1,autoClose:3e3})}else s.error("something went wrong"),s.update(t,{render:"Failed to update coins",type:"error",isLoading:!1,autoClose:3e3})}catch(c){console.log(c),u(),s.update(t,{render:"Error processing withdrawal request",type:"error",isLoading:!1,autoClose:3e3})}finally{j(!1),v(!0)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx("title",{children:"Profile | YegnaCart"}),e.jsx("meta",{name:"description",content:"View and manage your YegnaCart profile, check your YegnaCoins balance, invite friends, and request withdrawals."})]}),e.jsxs("div",{className:"max-w-3xl mx-auto mt-10 p-1 sm:p-3 bg-white shadow-lg rounded-2xl border border-gray-200 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[l.avatar?e.jsx("img",{src:l.avatar,alt:"User Avatar",className:"w-12 h-12 rounded-full"}):e.jsxs("div",{className:"flex items-center justify-center bg-red-100 w-[50px] h-[50px] rounded-full",children:[" ",e.jsx(I,{className:"w-6 h-6 text-indigo-600"})," "]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Welcome to your profile"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-indigo-500"}),e.jsx("span",{children:l.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-indigo-500"}),e.jsx("span",{children:l._id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("span",{children:["YegnaCoins: ",e.jsx("strong",{children:l.coins})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-indigo-50 border border-indigo-200 rounded-xl",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("p",{className:"text-indigo-700 font-medium",children:"🎁 Invite friends"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(J,{className:"w-4 h-4"}),"Share"]}),e.jsx("span",{className:"text-sm text-gray-500 break-all",children:b})]})]}),e.jsx("button",{onClick:()=>k(!x),className:"mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition",children:x?"Cancel Withdrawal":"Request Withdrawal"}),x&&e.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${p?"bg-red-50":"bg-green-50"} ${i<r?"bg-red-200":"bg-200"}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Withdrawal Request"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Enter your bank account details to request a withdrawal."}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 font-extrabold",children:"1 YegnaCoins = 0.25 ETB"}),p&&e.jsx("p",{className:"text-red-600 text-sm mb-4",children:"Minimum withdrawal amount is 999 YegnaCoins."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"Withdrawal Amount (in YegnaCoins)"}),e.jsx("input",{type:"number",placeholder:"Withdrawal Amount",onChange:t=>h(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"ETB"}),e.jsx("input",{type:"text",placeholder:"Withdrawal Amount",value:r*.25+" ETB",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"Balance"}),e.jsx("input",{type:"number",placeholder:"😠😠😠😠",disabled:!0,value:i<r?"":i-r,onChange:t=>h(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]})]}),e.jsxs("div",{className:"w-full p-1",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Account Holder Name"}),e.jsx("input",{onChange:t=>S(t.target.value),type:"text",placeholder:"Account Holder Name",className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"id"}),e.jsx("input",{type:"text",value:g,disabled:!0,className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"text",placeholder:"Phone Number",value:o,onChange:t=>Y(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsx("input",{type:"text",placeholder:"Bank Account Number",value:n,onChange:t=>C(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"}),e.jsx("button",{onClick:()=>{L()},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:A?e.jsx(D,{color:"#ffffff",size:20}):"Submit Withdrawal Request"})]})]}),e.jsx(_,{show:M,onClose:()=>v(!1),p1:`Hi ${d||"User"}, Your withdrawal request has been successfully submitted Please wait for the processing time to complete .`,p2:"Thank you for your patience!"})]})};export{ne as default};
