import{r as s,S as U,A as z,j as e,a as b,y as t}from"./index-DDIn7SRn.js";import{R as D}from"./ReceiptSuccessModal-2cOWBdkM.js";import{H}from"./Helmet-C6i6ylxE.js";import{C}from"./ClipLoader-CYxxZDlN.js";import{U as R}from"./user-XJDYVg0b.js";import{M as T}from"./mail-naEgIjtB.js";import{c as S}from"./createLucideIcon-BhGo9CUR.js";import"./index-Ca2FLHNw.js";import"./index-ozbJzmVH.js";import"./proxy-B9_KZtZh.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],_=S("gift",Z);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Y=S("share-2",J),ie=()=>{const{backendurl:o}=s.useContext(U),{token:u}=s.useContext(z),[m,A]=s.useState(!1),[l,E]=s.useState(0),[n,L]=s.useState(""),[x,W]=s.useState(""),[w,y]=s.useState(!1),[q,j]=s.useState(!0),[N,P]=s.useState(""),[h,v]=s.useState(!1),[r,I]=s.useState(null),[i,$]=s.useState(0),[d,M]=s.useState(""),[X,k]=s.useState(!1);s.useEffect(()=>{l<999?v(!0):v(!1)},[l]);const p=async()=>{j(!0);try{const a=await b.post(`${o}/api/user/me`,{},{headers:{token:u}});console.log("User data fetched:",a),a.data.success===!0?(I(a.data.userData),P(a.data.userData._id),$(a.data.userData.coins)):t.error("Failed to fetch user data")}catch(a){t.error("Error fetching user data"),console.error("Error fetching user data:",a)}finally{j(!1)}};s.useEffect(()=>{p()},[u,o]);const g=r!=null&&r.referralCode?`${window.location.origin}/register?ref=${r.referralCode}`:"",B=async()=>{try{navigator.share?await navigator.share({title:"Join zaycommerce",text:"Join zaycommerce and get exclusive benefits!",url:g}):(await navigator.clipboard.writeText(g),t.success("Invite link copied to clipboard!"))}catch(a){t.error("Failed to share invite link."),console.error(a)}};let F=async()=>{let a=t.loading("Processing withdrawal request...");if(!d.trim()||!/^09\d{8}$/.test(d)){t.error("Enter a valid Ethiopian phone number (e.g., 09XXXXXXXX)"),t.update(a,{render:"Invalid phone number",type:"error",isLoading:!1,autoClose:3e3});return}if(!n.trim()||n.length<6){t.error("Enter a valid Bank Account Number"),t.update(a,{render:"Invalid bank account number",type:"error",isLoading:!1,autoClose:3e3});return}if(h){t.error("Minimum withdrawal amount is 999 coin."),t.update(a,{render:"Minimum withdrawal amount not met",type:"error",isLoading:!1,autoClose:3e3});return}else if(l>i){t.error("You cannot withdraw more than your current balance."),t.update(a,{render:"Insufficient balance",type:"error",isLoading:!1,autoClose:3e3});return}y(!0);try{let c=i-l;if((await b.post(`${o}/api/withdrawal/withdrawal-update`,{coin:c},{headers:{token:u}})).data.success){const f=await b.post(`${o}/api/withdrawal/withdrawal-request`,{withdrawalAmount:l,bankAccount:n,name:x,userId:N,phone:d,leftDeposite:c});f.data.success?(p(),t.update(a,{render:"Withdrawal request submitted successfully!",type:"success",isLoading:!1,autoClose:3e3}),k(!0)):(t.error(f.data.message),t.update(a,{render:f.data.message,type:"error",isLoading:!1,autoClose:3e3}))}else t.error("Something went wrong"),t.update(a,{render:"Failed to update coins",type:"error",isLoading:!1,autoClose:3e3})}catch(c){console.error(c),p(),t.update(a,{render:"Error processing withdrawal request",type:"error",isLoading:!1,autoClose:3e3})}finally{y(!1)}};return q?e.jsxs("div",{className:"flex justify-center items-center h-[70vh] gap-2",children:[e.jsx(C,{color:"#4F46E5",size:30})," ",e.jsx("p",{children:"loading user data ....."})]}):r?e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx("title",{children:"Profile | zaycommerce"}),e.jsx("meta",{name:"description",content:"View and manage your zaycommerce profile, check your ZCoins balance, invite friends, and request withdrawals."})]}),e.jsxs("div",{className:"max-w-3xl mx-auto mt-10 p-1 sm:p-3 bg-white shadow-lg rounded-2xl border border-gray-200 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[r.avatar?e.jsx("img",{src:r.avatar,alt:"User Avatar",className:"w-12 h-12 rounded-full"}):e.jsxs("div",{className:"flex items-center justify-center bg-red-100 w-[50px] h-[50px] rounded-full",children:[" ",e.jsx(R,{className:"w-6 h-6 text-indigo-600"})," "]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Welcome to your profile"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-indigo-500"}),e.jsx("span",{children:r.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("span",{children:["ZCoins: ",e.jsx("strong",{children:r.coins})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-indigo-50 border border-indigo-200 rounded-xl",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("p",{className:"text-indigo-700 font-medium",children:"ðŸŽ Invite friends"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("button",{onClick:B,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(Y,{className:"w-4 h-4"}),"Share"]}),e.jsx("span",{className:"text-sm text-gray-500 break-all",children:g})]})]}),e.jsx("button",{onClick:()=>A(!m),className:"mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition",children:m?"Cancel Withdrawal":"Request Withdrawal"}),m&&e.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${h?"bg-red-50":"bg-green-50"} ${i<l?"bg-red-200":"bg-200"}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Withdrawal Request"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Enter your bank account details to request a withdrawal."}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 font-extrabold",children:"1 ZCoins = 0.25 ETB"}),h&&e.jsx("p",{className:"text-red-600 text-sm mb-4",children:"Minimum withdrawal amount is 999 ZCoins."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"Withdrawal Amount (in ZCoins)"}),e.jsx("input",{type:"number",placeholder:"Withdrawal Amount",onChange:a=>E(Number(a.target.value)),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"ETB"}),e.jsx("input",{type:"text",placeholder:"Withdrawal Amount",value:l*.25+" ETB",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-xs text-gray-700 mb-2",children:"Balance"}),e.jsx("input",{type:"number",placeholder:"ðŸ˜ ðŸ˜ ðŸ˜ ðŸ˜ ",disabled:!0,value:i<l?"Insufficient":i-l,className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]})]}),e.jsxs("div",{className:"w-full p-1",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Account Holder Name"}),e.jsx("input",{onChange:a=>W(a.target.value),type:"text",placeholder:"Account Holder Name",className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"id"}),e.jsx("input",{type:"text",value:N,disabled:!0,className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsxs("div",{className:"w-full p-1 ",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"text",placeholder:"Phone Number",value:d,onChange:a=>M(a.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"})]}),e.jsx("input",{type:"text",placeholder:"Bank Account Number",value:n,onChange:a=>L(a.target.value),className:"w-full p-2 border border-gray-300 rounded-lg mb-3"}),e.jsx("button",{onClick:F,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",disabled:w,children:w?e.jsx(C,{color:"#ffffff",size:20}):"Submit Withdrawal Request"})]})]}),e.jsx(D,{show:X,onClose:()=>k(!1),p1:`Hi ${x||"User"}, Your withdrawal request has been successfully submitted. Please wait for the processing time to complete.`,p2:"Thank you for your patience!"})]}):e.jsx("div",{className:"p-6 text-center text-red-600",children:"Failed to load profile data. Please try again."})};export{ie as default};
