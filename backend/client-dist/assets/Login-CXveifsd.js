import{r,A as R,b as $,S as q,d as z,j as e,a as u,y as l,s as U,e as W,p as H}from"./index-COKxKe4A.js";import{a as B,b as O,c as _,d as J,e as K}from"./index-BPNraHqv.js";import{H as M}from"./Helmet-CQML1vgr.js";import{a as C}from"./assets-nNy7GWIk.js";import{m as g}from"./proxy-Dkt98RHx.js";import{C as y}from"./ClipLoader-B7c-mFyc.js";const te=()=>{const[b,L]=r.useState(!1),{userData:Q,setToken:m,token:w}=r.useContext(R),i=$();let E=window.location.pathname==="/register";const[o,P]=r.useState(!!E),{backendurl:d}=r.useContext(q),[T,j]=r.useState(!1),[k,v]=r.useState(!1),[N,S]=r.useState(!1),[F]=z(),p=F.get("ref")||null;r.useEffect(()=>{w&&i("/")},[w,i]);const[n,x]=r.useState({name:"",email:"",password:""}),h=t=>{const{name:s,value:c}=t.target;x(a=>({...a,[s]:c}))},I=async t=>{var s,c;t.preventDefault(),t.target.querySelectorAll("input").forEach(a=>a.blur());try{if(j(!0),o){let a=await u.post(`${d}/api/user/register`,{name:n.name,email:n.email,password:n.password,referralCode:p});a.data.success?(l.success(a.data.message),m(a.data.token),localStorage.setItem("token",a.data.token),x({name:"",email:"",password:""}),i("/"),i("/")):l.error(a.data.message)}else{let a=await u.post(`${d}/api/user/login`,{email:n.email,password:n.password});a.data.success?(l.success(a.data.message),m(a.data.token),localStorage.setItem("token",a.data.token),x({name:"",email:"",password:""}),i("/")):l.error(a.data.message)}}catch(a){console.log(a),l.error(((c=(s=a.response)==null?void 0:s.data)==null?void 0:c.message)||"Network error, please try again.")}finally{j(!1)}},D=async()=>{try{v(!0);const t=await U(W,H),{displayName:s,email:c,photoURL:a,uid:G}=t.user,f=await u.post(`${d}/api/user/google-auth`,{googleId:G,name:s,email:c,avatar:a,referralCode:p});f.data.success&&(m(f.data.token),localStorage.setItem("token",f.data.token),i("/"))}catch(t){console.log(t),l.error("Google login failed. Please try again.")}finally{v(!1)}},A=async()=>{try{const t=window.Telegram.WebApp.initData;S(!0);const s=await u.post(`${d}/api/user/telegram-login`,{initData:t,referralCode:p});s.data.success?(m(s.data.token),localStorage.setItem("token",s.data.token),i("/")):l.error(s.data.message||"Telegram login failed. Please try again.")}catch(t){console.log(t),l.error("Telegram login failed. Please try again.")}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsxs("title",{children:[o?"Sign Up":"Login"," | E-commerce"]}),e.jsx("meta",{name:"description",content:o?"Create an account to start shopping on our E-commerce platform.":"Login to your E-commerce account to continue shopping."})]}),e.jsx("div",{className:"flex items-start justify-center min-h-screen pt-20 px-1 sm:px-0 ",style:{backgroundImage:`url(${C.loginbg})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(g.div,{className:"w-full  max-w-md p-6 rounded-xl text-gray-700 bg-white bg-opacity-90 shadow-lg ",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx(g.h2,{className:"text-xl font-bold mb-6 text-center",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2},children:o?"Create Account":"Welcome Back"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[o&&e.jsxs(g.div,{className:"relative",initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[e.jsx(B,{className:"absolute top-1/2 -translate-y-1/2 left-3 text-black group-focus-within:text-black transition"}),e.jsx("input",{type:"text",name:"name",placeholder:"Full Name",required:!0,value:n.name,onChange:h,className:"w-full pl-10 pr-10 py-2 text-sm border border-gray-700 rounded-lg shadow-sm outline-none focus:ring-2 focus:ring-black focus:border-black transition duration-200"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute top-1/2 -translate-y-1/2 left-3 text-black group-focus-within:text-black transition"}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",autoComplete:"email",required:!0,value:n.email,onChange:h,className:"w-full pl-10 pr-10 py-2 text-sm border border-gray-700 rounded-lg shadow-sm outline-none focus:ring-2 focus:ring-black focus:border-black transition duration-200"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(_,{className:"absolute top-1/2 -translate-y-1/2 left-3 text-black group-focus-within:text-black transition"}),e.jsx("input",{type:b?"text":"password",name:"password",placeholder:"Password",autoComplete:"current-password",required:!0,value:n.password,onChange:h,className:"w-full pl-10 pr-10 py-2 text-sm border border-gray-700 rounded-lg shadow-sm outline-none focus:ring-2 focus:ring-black focus:border-black transition duration-200"}),e.jsx("button",{type:"button",onClick:()=>L(t=>!t),className:"absolute top-1/2 right-3 -translate-y-1/2 text-black hover:text-black transition",children:b?e.jsx(J,{}):e.jsx(K,{})})]}),e.jsx(g.button,{type:"submit",className:"w-full py-2 text-sm font-semibold text-white bg-black rounded-lg hover:bg-gray-900 transition",whileTap:{scale:.97},children:T?e.jsx(y,{size:20,color:"white"}):o?"Sign up":"Login"})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:[o?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:()=>P(!o),className:"text-black hover:underline font-medium",children:o?"Login":"Sign up"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsx("div",{className:"h-px bg-gray-300 flex-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"OR"}),e.jsx("div",{className:"h-px bg-gray-300 flex-1"})]}),e.jsxs("button",{type:"button",onClick:D,className:"w-full mt-4 py-2 flex items-center justify-center gap-3 border border-gray-700 rounded-lg hover:bg-gray-100 transition",children:[!k&&e.jsx("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"Google",className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:k?e.jsx(y,{size:20}):"Continue with Google"})]}),e.jsxs("button",{type:"button",onClick:A,className:"w-full mt-4 py-2 flex items-center justify-center gap-3 border border-gray-700 rounded-lg hover:bg-gray-100 transition",children:[!N&&e.jsx("img",{src:C.tg_icon,alt:"Telegram",width:"25",height:"25"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:N?e.jsx(y,{size:20}):"Continue with telegram"})]})]})})]})};export{te as default};
