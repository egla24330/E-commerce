import{r as t,S as q,u as A,b as H,j as e,a as n,y as s}from"./index-DDIn7SRn.js";import{R as W}from"./ReceiptSuccessModal-2cOWBdkM.js";import{H as K}from"./Helmet-C6i6ylxE.js";import{c as X}from"./createLucideIcon-BhGo9CUR.js";import{m as v}from"./proxy-B9_KZtZh.js";import{X as G}from"./x-C5dJHmDC.js";import"./index-Ca2FLHNw.js";import"./index-ozbJzmVH.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Q=X("cloud-upload",J);function pe(){t.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const[r,w]=t.useState(null),[Y,Z]=t.useState(""),[k,T]=t.useState(""),[C,U]=t.useState(""),[P,R]=t.useState(0),[h,c]=t.useState(0),[D,i]=t.useState(0),[I,l]=t.useState("Calculating..."),[z,E]=t.useState(!1),[d,m]=t.useState(!1),[ee,f]=t.useState(!1),{backendurl:y}=t.useContext(q),{id:p}=A(),B=H(),o=t.useRef(null),g=t.useRef(null),F=()=>{E(!0)};let L=async()=>{try{const a=await n.post(`${y}/api/order/find-order`,{id:p});a.data.success?(T(a.data.order.customerInfo.name),U(a.data.order.customerInfo.phone),R(a.data.order.totalPrice)):s.error("Failed to fetch order details.")}catch{s.error("Error fetching order.")}};t.useEffect(()=>{L()},[]);const M=async a=>{if(a.preventDefault(),!r){s.error("Please upload your receipt.");return}const u=new FormData;u.append("receipt",r),u.append("id",p),o.current=n.CancelToken.source(),g.current=new Date().getTime();try{m(!0),f(!1),(await n.post(`${y}/api/order/upload-receipt`,u,{cancelToken:o.current.token,onUploadProgress:$=>{const{loaded:x,total:j,timeStamp:te}=$,O=Math.round(x*100/j),_=(new Date().getTime()-g.current)/1e3,S=x/_,N=(j-x)/S;c(O),i(S),l(N>0?`${Math.ceil(N)}s remaining`:"Finishing...")}})).data.success?(s.success("Receipt uploaded successfully!"),F()):s.error("Oops, something went wrong.")}catch(b){n.isCancel(b)?s.info("Upload canceled."):s.error("Upload failed.")}finally{m(!1),c(0),i(0),l("Calculating...")}},V=()=>{o.current&&(o.current.cancel(),f(!0),m(!1),c(0),i(0),l("Upload canceled."))};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx("title",{children:"Verify Payment | zaycommerce Shop"}),e.jsx("meta",{name:"description",content:"Upload your bank receipt to verify your payment for your zaycommerce Shop order."}),e.jsx("meta",{property:"og:title",content:"Verify Payment | zaycommerce Shop"}),e.jsx("meta",{property:"og:description",content:"Upload your bank receipt to verify your payment for your zaycommerce Shop order."})]}),e.jsxs("div",{className:"max-w-xl mx-auto mt-16 bg-white rounded-2xl shadow-lg p-8 border border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6 text-center",children:"ðŸ§¾ Payment Verification"}),e.jsxs("div",{className:"mb-6 space-y-1",children:[e.jsx("p",{className:"text-gray-500",children:"Order ID:"}),e.jsx("p",{className:"font-semibold text-gray-800 bg-gray-100 p-2 rounded-md",children:p}),e.jsx("p",{className:"text-gray-500",children:"Name:"}),e.jsx("p",{className:"font-semibold text-gray-800 bg-gray-100 p-2 rounded-md",children:k}),e.jsx("p",{className:"text-gray-500",children:"Phone:"}),e.jsxs("p",{className:"font-semibold text-gray-800 bg-gray-100 p-2 rounded-md",children:["+251 ",C]}),e.jsx("p",{className:"text-gray-500",children:"Total Amount:"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["ETB ",P]})]}),e.jsxs("form",{onSubmit:M,className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Upload Bank Receipt"}),e.jsxs("div",{className:"relative border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-400 transition",children:[r?e.jsx("img",{src:URL.createObjectURL(r),alt:"receipt"}):e.jsx(Q,{className:"mx-auto text-blue-500 mb-3",size:40}),e.jsx("p",{className:"text-gray-500 mb-2",children:r?r.name:"Click or drag to upload receipt"}),e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:a=>w(a.target.files[0]),className:"absolute inset-0 opacity-0 cursor-pointer"})]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-3/4 bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsxs(v.div,{initial:{width:0},animate:{width:`${h}%`},transition:{type:"spring",stiffness:100,damping:10},className:"bg-blue-600 h-4 text-xs text-white text-center",children:[h,"%"]})}),e.jsx("button",{type:"button",onClick:V,className:"ml-4 text-red-600 hover:text-red-800 p-2 rounded-full transition",children:e.jsx(G,{size:24})})]}),e.jsxs("div",{className:"text-center text-gray-600 text-sm mt-2",children:[`${(D/1024).toFixed(1)} KB/s`," â€¢ ",I]}),e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(v.svg,{className:"w-16 h-16 text-blue-600",viewBox:"0 0 100 100",initial:{rotate:0},animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},children:e.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"10",fill:"none",strokeLinecap:"round",strokeDasharray:"250",strokeDashoffset:"200"})})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg transition flex items-center justify-center",disabled:d,children:d?"Uploading...":"Submit for Verification"})]}),e.jsx("div",{children:e.jsx(W,{p1:"We received your receipt and will get back to you soon.",p2:"Thank you for your patience!",show:z,onClose:()=>{localStorage.removeItem("zaycommerce_cart"),localStorage.removeItem("order"),B("/"),location.reload()}})})]})]})}export{pe as default};
